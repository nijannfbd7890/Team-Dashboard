<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Marketing Management Dashboard</title>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- PapaParse for CSV -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <style>
    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f5f7fa;
      margin: 0;
      padding: 0;
    }
    header {
      background-color: #007bff;
      color: white;
      text-align: center;
      padding: 30px 10px;
    }
    h1 { margin: 0; font-size: 2rem; }
    h2 { margin-top: 5px; font-weight: normal; }

    .container {
      width: 90%;
      margin: 30px auto;
      text-align: center;
    }

    .metrics {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-around;
      margin-top: 20px;
    }

    .card {
      background: white;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      border-radius: 12px;
      padding: 20px;
      width: 22%;
      min-width: 250px;
      margin: 10px;
    }

    .card h3 { margin: 10px 0 5px; }
    .card p { font-size: 1.5rem; font-weight: bold; }

    select {
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      margin-top: 20px;
    }

    canvas {
      background: white;
      border-radius: 10px;
      padding: 20px;
      margin: 20px auto;
      display: block;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 30px;
      background: white;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }

    th, td {
      padding: 12px;
      border-bottom: 1px solid #eee;
      text-align: center;
    }

    th {
      background-color: #007bff;
      color: white;
    }

    .high { background-color: #d4edda; } /* Green for >95% */
    .medium { background-color: #fff3cd; } /* Yellow for 80–95% */
    .low { background-color: #f8d7da; } /* Red for <80% */
  </style>
</head>

<body>
  <header>
    <h1>Marketing Management Team Dashboard</h1>
    <h2>Performance Analytics — July to November 2025</h2>
  </header>

  <div class="container">
    <h3>Select Month:</h3>
    <select id="monthSelect">
      <option value="All">All</option>
    </select>

    <div class="metrics">
      <div class="card"><h3>Total Hours</h3><p id="totalHours">0h</p></div>
      <div class="card"><h3>Average Performance</h3><p id="avgPerformance">0%</p></div>
      <div class="card"><h3>Team Members</h3><p id="teamCount">0</p></div>
      <div class="card"><h3>Top Performer</h3><p id="topPerformer">-</p></div>
    </div>

    <canvas id="hoursChart" height="100"></canvas>
    <canvas id="performanceChart" height="100"></canvas>

    <table id="dataTable">
      <thead>
        <tr>
          <th>Name</th>
          <th>Performance</th>
          <th>Remarks</th>
          <th>Hours</th>
          <th>Month</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    const csvUrl = "https://nijannfbd7890.github.io/Team-Dashboard/team_report.csv";
    let data = [];

    Papa.parse(csvUrl, {
      download: true,
      header: true,
      complete: function(results) {
        data = results.data.filter(row => row.Name && row.Performance);
        populateDropdown();
        updateDashboard("All");
      }
    });

    function populateDropdown() {
      const months = [...new Set(data.map(d => d.Month))];
      const monthSelect = document.getElementById("monthSelect");
      months.forEach(m => {
        const option = document.createElement("option");
        option.value = m;
        option.textContent = m;
        monthSelect.appendChild(option);
      });
      monthSelect.addEventListener("change", () => updateDashboard(monthSelect.value));
    }

    function updateDashboard(selectedMonth) {
      let filtered = selectedMonth === "All" ? data : data.filter(d => d.Month === selectedMonth);

      const totalHours = filtered.reduce((sum, d) => sum + parseFloat((d.Hours || "0").replace(/[^0-9.]/g, "")), 0);
      const avgPerformance = (filtered.reduce((sum, d) => sum + parseFloat(d.Performance), 0) / filtered.length || 0).toFixed(1);
      const topPerformer = filtered.reduce((best, d) => (parseFloat(d.Performance) > parseFloat(best.Performance || 0) ? d : best), {}).Name || "-";

      document.getElementById("totalHours").textContent = totalHours.toFixed(0) + "h";
      document.getElementById("avgPerformance").textContent = avgPerformance + "%";
      document.getElementById("teamCount").textContent = filtered.length;
      document.getElementById("topPerformer").textContent = topPerformer;

      renderCharts(filtered);
      renderTable(filtered);
    }

    function renderCharts(filtered) {
      const monthHours = {};
      filtered.forEach(d => {
        monthHours[d.Month] = (monthHours[d.Month] || 0) + parseFloat((d.Hours || "0").replace(/[^0-9.]/g, ""));
      });
      const labels = Object.keys(monthHours);
      const values = Object.values(monthHours);

      new Chart(document.getElementById("hoursChart"), {
        type: "bar",
        data: {
          labels,
          datasets: [{
            label: "Hours by Month",
            data: values,
            borderWidth: 1
          }]
        },
        options: { scales: { y: { beginAtZero: true } } }
      });

      const performanceByMonth = {};
      filtered.forEach(d => {
        const month = d.Month;
        if (!performanceByMonth[month]) performanceByMonth[month] = [];
        performanceByMonth[month].push(parseFloat(d.Performance));
      });
      const perfLabels = Object.keys(performanceByMonth);
      const perfValues = perfLabels.map(m => 
        performanceByMonth[m].reduce((a, b) => a + b, 0) / performanceByMonth[m].length
      );

      new Chart(document.getElementById("performanceChart"), {
        type: "line",
        data: {
          labels: perfLabels,
          datasets: [{
            label: "Average Performance (%)",
            data: perfValues,
            fill: false,
            tension: 0.3,
            borderWidth: 2
          }]
        },
        options: { scales: { y: { beginAtZero: true, max: 110 } } }
      });
    }

    function renderTable(filtered) {
      const tbody = document.querySelector("#dataTable tbody");
      tbody.innerHTML = "";
      filtered.forEach(d => {
        const tr = document.createElement("tr");
        const performance = parseFloat(d.Performance);
        let cls = "low";
        if (performance > 95) cls = "high";
        else if (performance > 80) cls = "medium";
        tr.className = cls;

        tr.innerHTML = `
          <td>${d.Name}</td>
          <td>${d.Performance}%</td>
          <td>${d.Remarks}</td>
          <td>${d.Hours}</td>
          <td>${d.Month}</td>
        `;
        tbody.appendChild(tr);
      });
    }
  </script>
</body>
</html>
